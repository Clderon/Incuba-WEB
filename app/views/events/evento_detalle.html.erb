<!-- app/views/home/evento_detalle.html.erb - ACTUALIZADO PARA MÚLTIPLES IMÁGENES -->

<!-- Font Awesome y Google Fonts -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "home" %>
  <%= stylesheet_link_tag "evento_detalle" %>
<% end %>

<% content_for :scripts do %>
  <%= javascript_include_tag "enhanced_header", defer: true %>
  <%= javascript_include_tag "footer", defer: true %>
<% end %>

<!-- Header -->
<header class="header" role="banner">
  <div class="header__container">
    <div class="header__logo">
      <a href="/" class="header__logo-link" aria-label="Ir al inicio">
        <div class="header__logo-container">
          <%= image_tag "logo-incuba.webp", alt: "Logo Incuba UNAS", class: "header__logo-img", loading: "lazy" %>
        </div>
        <div class="header__text-container">
          <span class="header__logo-text">INCUBA UNAS</span>
        </div>
      </a>
    </div>

    <nav class="header__nav" role="navigation" aria-label="Navegación principal">
      <ul class="header__menu">
        <li class="header__menu-item header__menu-item--has-dropdown">
          <%= link_to t('navigation.programas'), programas_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
        </li>

        <li class="header__menu-item header__menu-item--has-dropdown">
          <%= link_to t('navigation.eventos'), eventos_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
          <div class="header__dropdown" role="menu">
            <ul class="header__dropdown-menu">
              <li class="header__dropdown-item">
                <a href="eventos/#proximosEventos" class="header__dropdown-link" role="menuitem">Próximos Eventos</a>
              </li>
              <li class="header__dropdown-item">
                <a href="eventos/#eventosPasados" class="header__dropdown-link" role="menuitem">Eventos Pasados</a>
              </li>
            </ul>
          </div>
        </li>

        <li class="header__menu-item header__menu-item--has-dropdown">
          <%= link_to t('navigation.servicios'), servicios_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
          <div class="header__dropdown" role="menu">
            <ul class="header__dropdown-menu">
              <li class="header__dropdown-item">
                <a href="/servicios/preincubacion" class="header__dropdown-link" role="menuitem">Preincubación</a>
              </li>
              <li class="header__dropdown-item">
                <a href="/servicios/incubacion" class="header__dropdown-link" role="menuitem">Incubación</a>
              </li>
              <li class="header__dropdown-item">
                <a href="servicios/#otrosSection" class="header__dropdown-link" role="menuitem">Otros</a>
              </li>
            </ul>
          </div>
        </li>

        <li class="header__menu-item header__menu-item--has-dropdown">
          <%= link_to t('navigation.nosotros'), about_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
          <div class="header__dropdown" role="menu">
            <ul class="header__dropdown-menu">
              <li class="header__dropdown-item">
                <a href="/about#nuestroEquipo" class="header__dropdown-link" role="menuitem">Nuestro Equipo</a>
              </li>
              <li class="header__dropdown-item">
                <a href="/about#valores" class="header__dropdown-link" role="menuitem">Valores</a>
              </li>
              <li class="header__dropdown-item">
                <a href="/about#nuestraHistoria" class="header__dropdown-link" role="menuitem">Nuestra Historia</a>
              </li>
            </ul>
          </div>
        </li>

        <li class="header__menu-item header__menu-item--has-dropdown">
          <%= link_to t('navigation.mentores'), mentores_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
          <div class="header__dropdown" role="menu">
            <ul class="header__dropdown-menu">
              <li class="header__dropdown-item">
                <a href="/mentores#unas" class="header__dropdown-link" role="menuitem">De la UNAS</a>
              </li>
              <li class="header__dropdown-item">
                <a href="/mentores#instituciones" class="header__dropdown-link" role="menuitem">Otras Instituciones</a>
              </li>
            </ul>
          </div>
        </li>

        <li class="header__menu-item">
          <%= link_to t('navigation.contacto'), contact_path, class: "header__menu-link" %>
        </li>

        <!-- Dark-Mode toggle -->
        <li class="header__menu-item">
          <button id="toggle-dark" class="header__menu-link" style="background: none; border: none;">
            <i id="theme-icon" class="fas fa-moon"></i>
          </button>
        </li>

      </ul>
    </nav>

    <div class="header__actions">
      <%= render 'shared/language_switcher' %>
      
      <div class="header__login-container">
        <a href="<%= new_user_session_path %>"
           class="header__action-btn header__action-btn--login"
           data-turbo="false"
           aria-label="<%= t('navigation.iniciar_sesion') %>">
           <i class="fa-solid fa-user"></i>
        </a>
        <span class="header__login-text"><%= t('navigation.iniciar_sesion') %></span>
      </div>

      <a href="<%= new_user_session_path %>"
         class="header__action-btn header__action-btn--mobile"
         data-turbo="false"
         aria-label="Iniciar sesión">
        <i class="fas fa-user" aria-hidden="true"></i>
      </a>
    </div>

    <button class="header__hamburger" aria-label="Abrir menú de navegación" aria-expanded="false">
      <span class="header__hamburger-line" aria-hidden="true"></span>
      <span class="header__hamburger-line" aria-hidden="true"></span>
      <span class="header__hamburger-line" aria-hidden="true"></span>
    </button>
  </div>
</header>

<!-- Decoración de fondo -->
<div class="background-decoration">
  <div class="bg-circle bg-circle-1"></div>
  <div class="bg-circle bg-circle-2"></div>
  <div class="bg-circle bg-circle-3"></div>
  <div class="bg-dots"></div>
  <div class="bg-line bg-line-1"></div>
  <div class="bg-line bg-line-2"></div>
</div>

<!-- Contenido principal del detalle del evento -->
<div class="evento-detalle-container">
  
  <!-- Navegación superior -->
  <div class="evento-navegacion">
    <%= link_to eventos_path, class: "btn-volver" do %>
      <i class="fas fa-arrow-left"></i> Volver a Eventos
    <% end %>
  </div>

  <!-- Header informativo del evento -->
  <div class="evento-header-info">
    <div class="evento-badge-info">
      <i class="fas fa-calendar-alt"></i>
      EVENTO
    </div>
    <h1 class="evento-titulo"><%= @event.titulo %></h1>
    <p class="evento-descripcion-main"><%= @event.descripcion %></p>
    
    <!-- Información en línea -->
    <div class="evento-meta-info">
      <div class="meta-item">
        <i class="fas fa-user-tie"></i>
        <span><strong>Encargado:</strong> <%= @event.encargado %></span>
      </div>
      <div class="meta-item">
        <i class="fas fa-calendar-alt"></i>
        <span><strong>Disponible hasta:</strong> <%= @event.fecha_vencimiento.strftime("%d de %B del %Y") %></span>
      </div>
      <div class="meta-item">
        <i class="fas fa-users"></i>
        <span><strong>Inscripciones:</strong> <%= @total_inscripciones %></span>
      </div>
      <div class="meta-item">
        <i class="fas fa-circle" style="color: <%= @event.estado == 'activo' ? '#10b981' : '#dc2626' %>"></i>
        <span><strong>Estado:</strong> <%= @event.estado.humanize %></span>
      </div>
    </div>
  </div>

  <!-- NUEVA SECCIÓN: Carrusel de imágenes -->
  <div class="evento-imagen-carrusel">
    <% if @event.images.attached? %>
      <div class="carrusel-container" data-total-images="<%= @event.images.count %>">
        <div class="carrusel-wrapper">
          <div class="carrusel-track" id="carruselTrack">
            <% @event.images.each_with_index do |image, index| %>
              <div class="carrusel-slide <%= 'active' if index == 0 %>" data-slide="<%= index %>">
                <img 
                  src="<%= url_for(image) %>" 
                  alt="<%= @event.titulo %> - Imagen <%= index + 1 %>"
                  class="imagen-evento"
                >
                
                <!-- Estado del evento superpuesto solo en la primera imagen -->
                <% if index == 0 %>
                  <div class="evento-estado-overlay">
                    <span class="estado-badge estado-<%= @event.estado %>" style="background-color: <%= @event.color_estado %>;">
                      <i class="fas <%= 
                        case @event.estado
                        when 'pendiente' then 'fa-clock'
                        when 'activo' then 'fa-play-circle'
                        when 'finalizado' then 'fa-flag-checkered'
                        when 'inactivo' then 'fa-ban'
                        else 'fa-question-circle'
                        end
                      %>"></i>
                      <%= @event.estado.humanize %>
                    </span>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
          
          <!-- Controles del carrusel (solo si hay más de 1 imagen) -->
          <% if @event.images.count > 1 %>
            <button class="carrusel-control carrusel-prev" onclick="moveCarrusel(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="carrusel-control carrusel-next" onclick="moveCarrusel(1)">
              <i class="fas fa-chevron-right"></i>
            </button>
          <% end %>
        </div>
        
        <!-- Indicadores (solo si hay más de 1 imagen) -->
        <% if @event.images.count > 1 %>
          <div class="carrusel-indicators">
            <% @event.images.each_with_index do |image, index| %>
              <button 
                class="indicator <%= 'active' if index == 0 %>" 
                onclick="goToSlide(<%= index %>)"
                data-slide="<%= index %>"
              ></button>
            <% end %>
          </div>
        <% end %>
        
        <!-- Contador de imágenes (solo si hay más de 1 imagen) -->
        <% if @event.images.count > 1 %>
          <div class="image-counter">
            <span id="currentSlide">1</span> / <span id="totalSlides"><%= @event.images.count %></span>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- Imagen placeholder cuando no hay imágenes -->
      <div class="carrusel-container">
        <div class="carrusel-wrapper">
          <div class="carrusel-track">
            <div class="carrusel-slide active">
              <img 
                src="<%= asset_path('event-placeholder.png') %>" 
                alt="<%= @event.titulo %>"
                class="imagen-evento placeholder"
              >
              
              <div class="evento-estado-overlay">
                <span class="estado-badge estado-<%= @event.estado %>" style="background-color: <%= @event.color_estado %>;">
                  <i class="fas <%= 
                    case @event.estado
                    when 'pendiente' then 'fa-clock'
                    when 'activo' then 'fa-play-circle'
                    when 'finalizado' then 'fa-flag-checkered'
                    when 'inactivo' then 'fa-ban'
                    else 'fa-question-circle'
                    end
                  %>"></i>
                  <%= @event.estado.humanize %>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Información del evento -->
  <div class="evento-info-section">
    <h2><i class="fas fa-info-circle"></i> Información del Evento</h2>
    <div class="evento-info-grid">
      
      <div class="info-card">
        <div class="info-header">
          <i class="fas fa-calendar-check"></i>
          <h3>Fechas Importantes</h3>
        </div>
        <div class="info-content">
          <p><strong>Fecha de Publicación:</strong><br>
             <%= @event.fecha_publicacion.strftime("%d de %B del %Y a las %H:%M") %></p>
          <p><strong>Fecha de Vencimiento:</strong><br>
             <%= @event.fecha_vencimiento.strftime("%d de %B del %Y a las %H:%M") %></p>
        </div>
      </div>
      
      <div class="info-card">
        <div class="info-header">
          <i class="fas fa-chart-line"></i>
          <h3>Estado del Evento</h3>
        </div>
        <div class="info-content">
          <div class="estado-visual">
            <span class="estado-badge estado-<%= @event.estado %>" style="background-color: <%= @event.color_estado %>;">
              <i class="fas <%= 
                case @event.estado
                when 'pendiente' then 'fa-clock'
                when 'activo' then 'fa-play-circle'
                when 'finalizado' then 'fa-flag-checkered'
                when 'inactivo' then 'fa-ban'
                else 'fa-question-circle'
                end
              %>"></i>
              <%= @event.estado.humanize %>
            </span>
          </div>
          <p><%= @mensaje_disponibilidad %></p>
        </div>
      </div>
      
      <div class="info-card">
        <div class="info-header">
          <i class="fas fa-users"></i>
          <h3>Participación</h3>
        </div>
        <div class="info-content">
          <p><strong>Total de Inscripciones:</strong><br>
             <%= @total_inscripciones %> participantes</p>
          <p><strong>Estado de Inscripciones:</strong><br>
             <%= @puede_inscribirse ? "Abiertas" : "Cerradas" %></p>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Acción de inscripción según estado -->
  <div class="evento-accion-final">
    <% if @puede_inscribirse %>
      <div class="accion-disponible">
        <h3>¿Listo para participar?</h3>
        <p>Únete a este evento y forma parte de nuestra comunidad emprendedora</p>
        <%= link_to inscripcion_evento_path(@event), class: "btn-inscribirse-grande" do %>
          <i class="fas fa-paper-plane"></i>
          Inscribirse Ahora
        <% end %>
        <div class="disponibilidad-info estado-activo">
          <i class="fas fa-clock"></i>
          <%= @mensaje_disponibilidad %>
        </div>
      </div>
    <% elsif @event.estado == 'pendiente' %>
      <div class="accion-pendiente">
        <i class="fas fa-hourglass-half"></i>
        <h3>Inscripciones Próximamente</h3>
        <p>Este evento estará disponible para inscripciones pronto.</p>
        <div class="disponibilidad-info estado-pendiente">
          <i class="fas fa-calendar-alt"></i>
          <%= @mensaje_disponibilidad %>
        </div>
      </div>
    <% elsif @event.estado == 'finalizado' %>
      <div class="accion-finalizada">
        <i class="fas fa-flag-checkered"></i>
        <h3>Evento Finalizado</h3>
        <p>Este evento ya ha concluido, pero mantente atento a futuros eventos.</p>
        <div class="disponibilidad-info estado-finalizado">
          <i class="fas fa-calendar-times"></i>
          <%= @mensaje_disponibilidad %>
        </div>
      </div>
    <% else %>
      <div class="accion-no-disponible">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Evento no disponible</h3>
        <p>Este evento no está disponible actualmente.</p>
      </div>
    <% end %>
  </div>

</div>

<!-- Footer -->
<footer class="footer">
    <div class="footer__decoration footer__decoration--top-left"></div>
    <div class="footer__decoration footer__decoration--bottom-right"></div>

    <div class="footer__container">
        <div class="footer__column footer__column--main">
            <div class="footer__logo-container">
                <div class="footer__logo">
                    <span class="footer__logo-icon">I</span>NCUBA UNAS
                </div>
                <p class="footer__description">
                    Incuba UNAS es una incubadora de empresas que busca impulsar el desarrollo de
                    emprendimientos innovadores y sostenibles en la región.
                </p>
            </div>

            <form class="footer__subscribe" onsubmit="sendMail(event)">
                <label for="emailInput" class="footer__label">Correo electrónico</label>
                <input type="email" id="emailInput" class="footer__input" placeholder="Enter email" required>
                
                <button type="submit" class="footer__button">
                  <i class="fas fa-arrow-right"></i> Contacto
                </button>
              </form>

            <div class="footer__social">
                <a href="#" class="footer__social-link">
                    <i class='fab fa-instagram'></i>
                </a>
                <a href="#" class="footer__social-link">
                    <i class='fab fa-twitter'></i>
                </a>
                <a href="#" class="footer__social-link">
                    <i class='fab fa-facebook'></i>
                </a>
            </div>
        </div>

        <div class="footer__column">
            <h3 class="footer__heading">Principal</h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">Programas</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Nosotros</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Portafolio</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Equipo</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Servicios</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Contacto</a></li>
            </ul>
        </div>

        <div class="footer__column">
            <h3 class="footer__heading">Nosotros</h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">Otros servicios</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Tutores</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Eventos</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Pro Innova</a></li>
            </ul>
        </div>

        <div class="footer__column">
            <h3 class="footer__heading">Enlaces de Interés</h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">UNAS</a></li>
                <li class="footer__item"><a href="#" class="footer__link">PRO Innóvate</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Ministerio de la Producción</a></li>
            </ul>
        </div>
    </div>
</footer>

<!-- JavaScript para el carrusel -->
<script>
  let currentSlideIndex = 0;
  let totalSlides = 0;

  document.addEventListener('DOMContentLoaded', function() {
    const container = document.querySelector('.carrusel-container');
    if (container) {
      totalSlides = parseInt(container.dataset.totalImages) || 0;
      updateSlideCounter();
      
      // Auto-reproducir carrusel si hay más de 1 imagen
      if (totalSlides > 1) {
        setInterval(autoPlay, 5000); // Cambiar cada 5 segundos
      }
    }
  });

  function moveCarrusel(direction) {
    const track = document.getElementById('carruselTrack');
    const slides = track.querySelectorAll('.carrusel-slide');
    const indicators = document.querySelectorAll('.indicator');
    
    if (slides.length === 0) return;
    
    // Remover clase active de slide actual
    slides[currentSlideIndex].classList.remove('active');
    if (indicators.length > 0) {
      indicators[currentSlideIndex].classList.remove('active');
    }
    
    // Calcular nuevo índice
    currentSlideIndex += direction;
    
    if (currentSlideIndex >= slides.length) {
      currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
      currentSlideIndex = slides.length - 1;
    }
    
    // Agregar clase active al nuevo slide
    slides[currentSlideIndex].classList.add('active');
    if (indicators.length > 0) {
      indicators[currentSlideIndex].classList.add('active');
    }
    
    // Mover el track
    const translateX = -currentSlideIndex * 100;
    track.style.transform = `translateX(${translateX}%)`;
    
    updateSlideCounter();
  }

  function goToSlide(index) {
    const track = document.getElementById('carruselTrack');
    const slides = track.querySelectorAll('.carrusel-slide');
    const indicators = document.querySelectorAll('.indicator');
    
    if (index < 0 || index >= slides.length) return;
    
    // Remover clase active de slide actual
    slides[currentSlideIndex].classList.remove('active');
    if (indicators.length > 0) {
      indicators[currentSlideIndex].classList.remove('active');
    }
    
    // Actualizar índice
    currentSlideIndex = index;
    
    // Agregar clase active al nuevo slide
    slides[currentSlideIndex].classList.add('active');
    if (indicators.length > 0) {
      indicators[currentSlideIndex].classList.add('active');
    }
    
    // Mover el track
    const translateX = -currentSlideIndex * 100;
    track.style.transform = `translateX(${translateX}%)`;
    
    updateSlideCounter();
  }

  function updateSlideCounter() {
    const currentSlideElement = document.getElementById('currentSlide');
    const totalSlidesElement = document.getElementById('totalSlides');
    
    if (currentSlideElement) {
      currentSlideElement.textContent = currentSlideIndex + 1;
    }
    if (totalSlidesElement) {
      totalSlidesElement.textContent = totalSlides;
    }
  }

  function autoPlay() {
    if (totalSlides > 1) {
      moveCarrusel(1);
    }
  }

  // Soporte para teclas de navegación
  document.addEventListener('keydown', function(e) {
    if (totalSlides > 1) {
      if (e.key === 'ArrowLeft') {
        moveCarrusel(-1);
      } else if (e.key === 'ArrowRight') {
        moveCarrusel(1);
      }
    }
  });

  // Pausar auto-reproducción al hacer hover
  const carruselContainer = document.querySelector('.carrusel-container');
  if (carruselContainer) {
    let autoPlayInterval;
    
    carruselContainer.addEventListener('mouseenter', function() {
      // Pausar auto-reproducción
    });
    
    carruselContainer.addEventListener('mouseleave', function() {
      // Reanudar auto-reproducción
    });
  }
</script>