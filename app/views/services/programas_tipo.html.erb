<!-- app/views/home/programas_tipo.html.erb -->

<!-- Font Awesome y Google Fonts -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "home" %>
  <%= stylesheet_link_tag "programa_tipo" %>
  <%= stylesheet_link_tag "swiper-bundle.min" %>
<% end %>

<% content_for :scripts do %>
  <%= javascript_include_tag "enhanced_header", defer: true %>
  <%= javascript_include_tag "footer", defer: true %>
<% end %>


<!-- Header reestructurado con dropdowns completos -->
    <header class="header" role="banner">
      <div class="header__container">
        <div class="header__logo">
          <a href="/" class="header__logo-link" aria-label="Ir al inicio">
            <!-- DIV SEPARADO PARA EL LOGO -->
            <div class="header__logo-container">
              <%= image_tag "logo-incuba.webp", alt: "Logo Incuba UNAS", class: "header__logo-img", loading: "lazy" %>
            </div>
            <!-- DIV SEPARADO PARA EL TEXTO -->
            <div class="header__text-container">
              <span class="header__logo-text">INCUBA UNAS</span>
            </div>
          </a>
        </div>

        <nav class="header__nav" role="navigation" aria-label="Navegación principal">
          <ul class="header__menu">
            <!-- PROGRAMAS -->
            <li class="header__menu-item header__menu-item--has-dropdown">
              <a href="#" class="header__menu-link"><%= t('navigation.programas') %></a>
              <div class="header__dropdown" role="menu">
                <ul class="header__dropdown-menu">
                  <li class="header__dropdown-item">
                    <a href="#" class="header__dropdown-link" role="menuitem">Nuestros Programas</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="#" class="header__dropdown-link" role="menuitem">Convocatorias</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="#" class="header__dropdown-link" role="menuitem">Startup Culminados</a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- EVENTOS -->
            <li class="header__menu-item header__menu-item--has-dropdown">
              <%= link_to t('navigation.eventos'), eventos_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
              <div class="header__dropdown" role="menu">
                <ul class="header__dropdown-menu">
                  <li class="header__dropdown-item">
                    <a href="eventos/#proximosEventos" class="header__dropdown-link" role="menuitem">Próximos Eventos</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="eventos/#eventosPasados" class="header__dropdown-link" role="menuitem">Eventos Pasados</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="#" class="header__dropdown-link" role="menuitem">Noticias</a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- SERVICIOS -->
            <li class="header__menu-item header__menu-item--has-dropdown">
              <%= link_to t('navigation.servicios'), servicios_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
              <div class="header__dropdown" role="menu">
                <ul class="header__dropdown-menu">
                  <li class="header__dropdown-item">
                    <a href="/servicios/preincubacion" class="header__dropdown-link" role="menuitem">Preincubación</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="/servicios/incubacion" class="header__dropdown-link" role="menuitem">Incubación</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="/servicios/innovacion" class="header__dropdown-link" role="menuitem">Open Innovation</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="" class="header__dropdown-link" role="menuitem">Otros</a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- NOSOTROS -->
            <li class="header__menu-item header__menu-item--has-dropdown">
              <%= link_to t('navigation.nosotros'), about_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
              <div class="header__dropdown" role="menu">
                <ul class="header__dropdown-menu">
                  <li class="header__dropdown-item">
                    <a href="/about#nuestroEquipo" class="header__dropdown-link" role="menuitem">Nuestro Equipo</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="/about#valores" class="header__dropdown-link" role="menuitem">Valores</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="/about#nuestraHistoria" class="header__dropdown-link" role="menuitem">Nuestra Historia</a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- MENTORES -->
            <li class="header__menu-item header__menu-item--has-dropdown">
              <%= link_to t('navigation.mentores'), mentores_path, class: "header__menu-link", "aria-haspopup" => "true", "aria-expanded" => "false" %>
              <div class="header__dropdown" role="menu">
                <ul class="header__dropdown-menu">
                  <li class="header__dropdown-item">
                    <a href="/mentores#unas" class="header__dropdown-link" role="menuitem">De la UNAS</a>
                  </li>
                  <li class="header__dropdown-item">
                    <a href="/mentores#instituciones" class="header__dropdown-link" role="menuitem">Otras Instituciones</a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- CONTACTO -->
            <li class="header__menu-item">
              <%= link_to t('navigation.contacto'), contact_path, class: "header__menu-link" %>
            </li>
          </ul>
        </nav>

        <!-- LOGIN Y SELECTOR DE IDIOMA DESKTOP + LOGIN MÓVIL -->
        <div class="header__actions">
          <!-- SELECTOR DE IDIOMA -->
          <%= render 'shared/language_switcher' %>
          
          <!-- LOGIN DESKTOP -->
          <div class="header__login-container">
            <a href="<%= new_user_session_path %>"
               class="header__action-btn header__action-btn--login"
               data-turbo="false"
               aria-label="<%= t('navigation.iniciar_sesion') %>">
            </a>
            <span class="header__login-text"><%= t('navigation.iniciar_sesion') %></span>
          </div>

          <!-- LOGIN MÓVIL - AHORA AQUÍ FUERA DEL MENÚ -->
          <a href="<%= new_user_session_path %>"
             class="header__action-btn header__action-btn--mobile"
             data-turbo="false"
             aria-label="Iniciar sesión">
            <i class="fas fa-user" aria-hidden="true"></i>
          </a>
        </div>

        <button class="header__hamburger" aria-label="Abrir menú de navegación" aria-expanded="false">
          <span class="header__hamburger-line" aria-hidden="true"></span>
          <span class="header__hamburger-line" aria-hidden="true"></span>
          <span class="header__hamburger-line" aria-hidden="true"></span>
        </button>
      </div>
    </header>

<!-- Decoración de fondo -->
<div class="background-decoration">
  <div class="bg-circle bg-circle-1"></div>
  <div class="bg-circle bg-circle-2"></div>
  <div class="bg-circle bg-circle-3"></div>
  <div class="bg-dots"></div>
  <div class="bg-line bg-line-1"></div>
  <div class="bg-line bg-line-2"></div>
</div>

<div class="programas-tipo-container">
  <div class="programas-tipo-header" style="background: linear-gradient(135deg, <%= @tipo_actual[:color] %>, <%= @tipo_actual[:color] %>aa)">
    <div class="tipo-icono">
      <i class="fas <%= @tipo_actual[:icono] %>"></i>
    </div>
    <div class="tipo-info">
      <div class="tipo-badge">PROGRAMAS</div>
      <h1><%= @tipo_actual[:titulo] %></h1>
      <p><%= @tipo_actual[:descripcion] %></p>
    </div>
  </div>
  
  <div class="volver-container">
    <a href="/servicios" class="btn-volver">
      <i class="fas fa-arrow-left"></i> Volver a Servicios
    </a>
  </div>
  
  <div class="programas-grid">
    <% if @programs && @programs.length > 0 %>
      <% @programs.each do |programa| %>
        <div class="programa-card" data-programa-id="<%= programa.id %>" data-estado="<%= programa.estado %>">
          <div class="programa-imagen" style="border-color: <%= @tipo_actual[:color] %>">
            <div class="imagen-overlay"></div>
            <img 
              src="<%= programa.image.attached? ? url_for(programa.image) : asset_path('program-placeholder.png') %>" 
              alt="<%= programa.titulo %>"
              loading="lazy"
            >
            
            <!-- Indicador de estado en la esquina superior derecha -->
            <div class="programa-estado">
              <span class="estado-badge estado-<%= programa.estado %>" style="background-color: <%= programa.color_estado %>;">
                <i class="fas <%= 
                  case programa.estado
                  when 'pendiente' then 'fa-clock'
                  when 'activo' then 'fa-play-circle'
                  when 'finalizado' then 'fa-flag-checkered'
                  when 'inactivo' then 'fa-ban'
                  else 'fa-question-circle'
                  end
                %>"></i>
                <%= programa.estado.humanize %>
              </span>
            </div>
            
            <!-- Fecha (movida más abajo para evitar superposición) -->
            <div class="programa-fecha" style="top: 60px;">
              <i class="far fa-calendar-alt"></i>
              <%= programa.fecha_vencimiento ? programa.fecha_vencimiento.strftime("%d/%m/%Y") : "Disponible" %>
            </div>
          </div>
          
          <div class="programa-content">
            <h2><%= programa.titulo %></h2>
            <p><%= programa.descripcion %></p>
            
            <!-- Mensaje de disponibilidad -->
            <div class="disponibilidad-info estado-<%= programa.estado %>">
              <i class="fas <%= 
                case programa.estado
                when 'pendiente' then 'fa-clock'
                when 'activo' then 'fa-check-circle'
                when 'finalizado' then 'fa-flag-checkered'
                when 'inactivo' then 'fa-ban'
                else 'fa-info-circle'
                end
              %>"></i>
              <span><%= programa.mensaje_disponibilidad %></span>
            </div>
            
            <div class="programa-actions">
              <a href="<%= "/programas/#{programa.id}" %>" class="btn-ver-detalles">
                Ver detalles
                <i class="fas fa-info-circle"></i>
              </a>
              
              <!-- Mostrar botón de inscripción solo si puede inscribirse -->
              <% if programa.puede_inscribirse? %>
                <a href="<%= "/programas/#{programa.id}/inscripcion" %>" class="btn-inscribirse">
                  Inscribirse
                  <i class="fas fa-arrow-right"></i>
                </a>
              <% else %>
                <!-- Mostrar botón deshabilitado con mensaje según el estado -->
                <% case programa.estado %>
                <% when 'pendiente' %>
                  <span class="btn-inscribirse btn-disabled" title="Las inscripciones aún no están disponibles">
                    Próximamente
                    <i class="fas fa-clock"></i>
                  </span>
                <% when 'finalizado' %>
                  <span class="btn-inscribirse btn-disabled" title="Las inscripciones han finalizado">
                    Finalizado
                    <i class="fas fa-flag-checkered"></i>
                  </span>
                <% when 'inactivo' %>
                  <span class="btn-inscribirse btn-disabled" title="Este programa ya no está disponible">
                    No disponible
                    <i class="fas fa-ban"></i>
                  </span>
                <% else %>
                  <span class="btn-inscribirse btn-disabled" title="Inscripciones no disponibles">
                    No disponible
                    <i class="fas fa-exclamation-triangle"></i>
                  </span>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="no-programas">
        <div class="no-programas-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <h3>No hay programas disponibles</h3>
        <p>Actualmente no hay programas disponibles en la categoría de <%= @tipo_actual[:titulo] %>. Por favor, vuelve a consultar próximamente.</p>
        <a href="/servicios" class="btn-volver-grande">
          <i class="fas fa-home"></i> Volver a la página de servicios
        </a>
      </div>
    <% end %>
  </div>
</div>

<!-- Sección Footer -->
<footer class="footer">
    <div class="footer__decoration footer__decoration--top-left"></div>
    <div class="footer__decoration footer__decoration--bottom-right"></div>

    <div class="footer__container">
        <!-- Columna izquierda: Logo y suscripción -->
        <div class="footer__column footer__column--main">
            <div class="footer__logo-container">
                <div class="footer__logo">
                    <span class="footer__logo-icon">I</span>NCUBA UNAS
                </div>
                <p class="footer__description">
                    Incuba UNAS es una incubadora de empresas que busca impulsar el desarrollo de
                    emprendimientos innovadores y sostenibles en la región.
                </p>
            </div>

            <form class="footer__subscribe">
                <input type="email" class="footer__input" placeholder="Enter email">
                <button type="submit" class="footer__button">
                    <i class="fas fa-arrow-right"></i>
                    Contacto
                </button>
            </form>

            <div class="footer__social">
                <a href="#" class="footer__social-link">
                    <i class='fab fa-instagram'></i>
                </a>
                <a href="#" class="footer__social-link">
                    <i class='fab fa-twitter'></i>
                </a>
                <a href="#" class="footer__social-link">
                    <i class='fab fa-facebook'></i>
                </a>
            </div>
        </div>

        <!-- Columnas de enlaces -->
        <div class="footer__column">
            <h3 class="footer__heading">Principal</h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">Programas</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Nosotros</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Portafolio</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Equipo</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Servicios</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Contacto</a></li>
            </ul>
        </div>

        <div class="footer__column">
            <h3 class="footer__heading">Nosotros</h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">Otros servicios</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Tutores</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Eventos</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Pro Innova</a></li>
            </ul>
        </div>

        <div class="footer__column">
            <h3 class="footer__heading">Enlaces de Interés </h3>
            <ul class="footer__links">
                <li class="footer__item"><a href="#" class="footer__link">UNAS</a></li>
                <li class="footer__item"><a href="#" class="footer__link">PRO Innóvate</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Ministerio de la Producción</a></li>
            </ul>
        </div>
    </div>
</footer>


<!-- Script JavaScript -->
<script>
  // Definir color actual en RGB para animaciones
  const colorParts = '<%= @tipo_actual[:color] %>'.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);
  let tipoColorRGB = '0, 0, 153'; // Valor por defecto
  
  if (colorParts) {
    const r = parseInt(colorParts[1], 16);
    const g = parseInt(colorParts[2], 16);
    const b = parseInt(colorParts[3], 16);
    tipoColorRGB = `${r}, ${g}, ${b}`;
    
    // Establecer variable CSS
    document.documentElement.style.setProperty('--tipo-color-rgb', tipoColorRGB);
    document.documentElement.style.setProperty('--tipo-color', '<%= @tipo_actual[:color] %>');
    document.documentElement.style.setProperty('--tipo-color-claro', '<%= @tipo_actual[:color_claro] %>');
  }
  
  // Función para manejar el efecto de ripple en botones
  function setupButtonRipples() {
    const buttons = document.querySelectorAll('.btn-inscribirse');
    
    buttons.forEach(button => {
      button.addEventListener('mouseenter', function(e) {
        const ripple = document.createElement('span');
        const rect = this.getBoundingClientRect();
        
        ripple.style.position = 'absolute';
        ripple.style.top = '50%';
        ripple.style.left = '50%';
        ripple.style.width = `${Math.max(rect.width, rect.height) * 2}px`;
        ripple.style.height = `${Math.max(rect.width, rect.height) * 2}px`;
        ripple.style.transform = 'translate(-50%, -50%) scale(0)';
        ripple.style.borderRadius = '50%';
        ripple.style.background = 'rgba(255, 255, 255, 0.3)';
        ripple.style.opacity = '1';
        ripple.style.transition = 'all 0.6s ease-out';
        ripple.style.pointerEvents = 'none';
        
        this.appendChild(ripple);
        
        setTimeout(() => {
          ripple.style.transform = 'translate(-50%, -50%) scale(1)';
          ripple.style.opacity = '0';
        }, 10);
        
        setTimeout(() => {
          if (ripple && ripple.parentNode) {
            ripple.parentNode.removeChild(ripple);
          }
        }, 600);
      });
    });
  }
  
  // Crear efecto paralaje para los elementos de fondo
  function setupParallaxEffect() {
    window.addEventListener('mousemove', function(e) {
      const circles = document.querySelectorAll('.bg-circle');
      const moveX = (e.clientX - window.innerWidth / 2) / 50;
      const moveY = (e.clientY - window.innerHeight / 2) / 50;
      
      circles.forEach((circle, index) => {
        const factor = (index + 1) * 0.4;
        circle.style.transform = `translate(${moveX * factor}px, ${moveY * factor}px)`;
      });
    });
  }
  
  // Animar las tarjetas de programas secuencialmente
  function animateProgramCards() {
    const cards = document.querySelectorAll('.programa-card');
    
    cards.forEach((card, index) => {
      // Aplicar retraso progresivo
      card.style.animationDelay = `${index * 0.1}s`;
    });
  }
  
  // Configurar animaciones para tarjetas al hacer hover
  function setupCardHoverEffects() {
    const cards = document.querySelectorAll('.programa-card');
    
    cards.forEach(card => {
      card.addEventListener('mouseenter', function() {
        // Obtener todas las demás tarjetas
        const otherCards = Array.from(cards).filter(c => c !== card);
        
        // Aplicar efecto de desenfoque a las otras tarjetas
        otherCards.forEach(otherCard => {
          otherCard.style.opacity = '0.7';
          otherCard.style.filter = 'blur(2px)';
          otherCard.style.transform = 'scale(0.98)';
        });
      });
      
      card.addEventListener('mouseleave', function() {
        // Restaurar todas las tarjetas
        cards.forEach(c => {
          c.style.opacity = '1';
          c.style.filter = 'blur(0)';
          c.style.transform = 'translateY(0)';
        });
      });
    });
  }
  
  // Asegurarnos de que todo se muestre correctamente
  function initPage() {
    // Asegurarnos de que todas las tarjetas sean visibles
    animateProgramCards();
    
    // Configurar efectos visuales
    setupButtonRipples();
    setupParallaxEffect();
    setupCardHoverEffects();
    
    // Forzar un reflow/repaint del navegador
    document.body.offsetHeight;
  }
  
  // Eventos para diferentes contextos de carga
  document.addEventListener('DOMContentLoaded', initPage);
  
  // Si estás usando Turbo, también escuchar eventos de Turbo
  if (typeof Turbo !== 'undefined') {
    document.addEventListener('turbo:load', initPage);
    document.addEventListener('turbo:render', initPage);
    document.addEventListener('turbo:visit', initPage);
  }
  
  // Asegurarse de que el scroll funcione correctamente
  window.addEventListener('load', function() {
    document.body.style.overflow = 'auto';
    document.documentElement.style.overflow = 'auto';
    
    // Timeout extra para navegadores que puedan tener comportamiento tardío
    setTimeout(initPage, 100);
  });
</script>